/*
 * Copyright (c) 2000	Linus Torvalds & authors
 */


#define IDE_IN(a,b,c)   ( ((a)<(b)) ? (b) : ( (a)>(c) ? (c) : (a)) )

#define IDE_IMPLY(a,b)	((!(a)) || (b))

#define QD_TIM1_PORT		(base)
#define QD_CONFIG_PORT		(base+0x01)
#define QD_TIM2_PORT		(base+0x02)
#define QD_CONTROL_PORT		(base+0x03)

#define QD_CONFIG_IDE_BASEPORT	0x01
#define QD_CONFIG_BASEPORT	0x02
#define QD_CONFIG_ID3		0x04
#define QD_CONFIG_DISABLED	0x08
#define QD_CONFIG_QD6500	0xc0
#define QD_CONFIG_QD6580_A	0xa0
#define QD_CONFIG_QD6580_B	0x50

#define QD_CONTR_SEC_DISABLED	0x01

#define QD_ID3			((config & QD_CONFIG_ID3)!=0)

#define QD_CONFIG(hwif)		((hwif)->config_data & 0x00ff)

static inline u8 QD_TIMING(ide_drive_t *drive)
{
	return (unsigned long)ide_get_drivedata(drive) & 0x00ff;
}

static inline u8 QD_TIMREG(ide_drive_t *drive)
{
	return ((unsigned long)ide_get_drivedata(drive) & 0xff00) >> 8;
}

#define QD6500_DEF_DATA		((QD_TIM1_PORT<<8) | (QD_ID3 ? 0x0c : 0x08))
#define QD6580_DEF_DATA		((QD_TIM1_PORT<<8) | (QD_ID3 ? 0x0a : 0x00))
#define QD6580_DEF_DATA2	((QD_TIM2_PORT<<8) | (QD_ID3 ? 0x0a : 0x00))
#define QD_DEF_CONTR		(0x40 | ((control & 0x02) ? 0x9f : 0x1f))

#define QD_TESTVAL		0x19	


static struct qd65xx_timing_s {
	s8	offset;   
	char	model[4];    
	s16	active;   
	s16	recovery; 
} qd65xx_timing [] = {
	{ 30, "2040", 110, 225 },  
	{ 30, "2045", 135, 225 },  
	{ 30, "1040", 155, 325 },  
	{ 30, "1047", 135, 265 },  
	{ 30, "5344", 135, 225 },  
	{ 30, "01 4", 175, 405 },  
	{ 27, "C030", 175, 375 },  
	{  8, "PL42", 110, 295 },  
	{  8, "PL21", 110, 315 },  
	{  8, "PL25", 175, 385 },  
	{  4, "PA24", 110, 285 },  
	{  6, "2200", 110, 260 },  
	{  6, "3204", 110, 235 },  
	{  6, "1202", 110, 265 },  
	{  0, "DS3-", 135, 315 },  
	{  8, "KM32", 175, 355 },  
	{  2, "53A1", 175, 355 },  
	{  2, "4108", 175, 295 },  
	{  2, "1344", 175, 335 },  
	{  6, "7 12", 110, 225 },  
	{ 30, "02F4", 145, 295 },  
	{  2, "1302", 175, 335 },  
	{  2, "2334", 145, 265 },  
	{  2, "2338", 145, 275 },  
	{  2, "3309", 145, 275 },  
	{  2, "5305", 145, 275 },  
	{  2, "4100", 175, 295 },  
	{  2, "4110", 175, 295 },  
	{  2, "6300", 135, 265 },  
	{  2, "5300", 135, 265 },  
	{  6, "7 31", 135, 225 },  
	{  6, "7 43", 115, 265 },  
	{  6, "7 42", 110, 255 },  
	{  6, "3 04", 135, 265 },  
	{  6, "61 0", 135, 285 },  
	{  6, "1107", 135, 235 },  
	{  6, "2101", 110, 220 },  
	{  6, "4202", 135, 245 },  
	{  6, "41 0", 175, 355 },  
	{  6, "82 0", 175, 355 },  
	{  8, "PL01", 175, 375 },  
	{  8, "PL25", 110, 295 },  
	{ 10, "4S 2", 175, 385 },  
	{ 10, "8S 5", 175, 385 },  
	{ 10, "1S72", 175, 385 },  
	{ 10, "1S07", 175, 385 },  
	{  8, "ZE42", 135, 295 },  
	{  8, "ZE21", 175, 385 },  
	{  8, "ZE58", 175, 385 },  
	{  8, "ZE24", 175, 385 },  
	{ 27, "C036", 155, 325 },  
	{ 27, "C038", 155, 325 },  
	{  6, "2205", 110, 255 },  
	{  2, " CHA", 140, 415 },  
	{  2, " CLA", 140, 415 },  
	{  4, "UC41", 140, 415 },  
	{  6, "1207", 130, 275 },  
	{  6, "2107", 130, 275 },  
	{  6, "5204", 130, 275 },  
	{ 30, "3004", 110, 235 },  
	{ 30, "0345", 135, 255 },  
	{ 12, "12A3", 175, 320 },  
	{ 12, "43A0", 145, 240 },  
	{  6, "7 21", 180, 290 },  
	{  6, "7 71", 135, 240 },  
	{ 12, "45\0000", 110, 205 },   
	{  8, "PL11", 180, 290 },  
	{  8, "OG21", 150, 275 },  
	{ 12, "42A5", 175, 320 },  
	{  2, "2309", 175, 295 },  
	{  2, "3358", 180, 310 },  
	{  2, "6355", 180, 310 },  
	{  2, "1900", 175, 270 },  
	{  2, "1954", 175, 270 },  
	{  2, "1909", 175, 270 },  
	{  2, "2953", 175, 270 },  
	{  2, "1359", 175, 270 },  
	{ 24, "3R11", 175, 290 },  
	{  0, "2M26", 175, 215 },  
	{  4, "2253", 175, 300 },  
	{  4, "-32A", 145, 245 },  
	{ 30, "0326", 150, 270 },  
	{ 30, "3044", 110, 195 },  
	{ 30, "43A0", 110, 195 },  
	{ -1, "    ", 175, 415 }   
};
